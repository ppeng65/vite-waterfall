import{g as u,c as j,E as A,F,i as C,o as d,a as h,G as L,H as P,q as w,p as W,r as O}from"./index.b93bf826.js";const R=n=>{const e=[];return n.forEach(o=>{e.push(...o.getElementsByTagName("img"))}),e},K=n=>n.map(e=>e.src),q=n=>{const e=[];return n.forEach((o,l)=>{e[l]=new Promise((f,m)=>{const c=new Image;c.src=o,c.onload=()=>{f({img:o,index:l})}})}),Promise.all(e)},S=n=>{const e=Object.values(n);return Math.min(...e)},I=n=>{const e=S(n);return Object.keys(n).find(o=>n[o]===e)},z=n=>{const e=Object.values(n);return Math.max(...e)},G={key:1},$={name:"index",props:{data:{type:Array,required:!0},nodeKey:{type:String},column:{type:Number,default:2},columnSpacing:{type:Number,default:20},rowSpacing:{type:Number,default:20},picturePreReading:{type:Boolean,default:!0}},setup(n){const e=n,o=u(0),l=u({}),f=()=>{l.value={};for(let t=0;t<e.column;t++)l.value[t]=0},m=u(null),c=u(0),p=u(0),b=()=>{const{paddingLeft:t,paddingRight:a}=getComputedStyle(m.value,null);p.value=parseFloat(t),c.value=m.value.offsetWidth-parseFloat(t)-parseFloat(a)},r=u(0),k=j(()=>(e.column-1)*e.columnSpacing),y=()=>{b(),r.value=(c.value-k.value)/e.column};A(()=>{y()});let i=[];const x=()=>{i=[];let t=[...document.getElementsByClassName("m-waterfall-item")];const a=R(t),s=K(a);q(s).then(()=>{t.forEach(g=>{i.push(g.offsetHeight)}),v()})},T=()=>{i=[],[...document.getElementsByClassName("m-waterfall-item")].forEach(a=>{i.push(a.offsetHeight)}),v()},v=()=>{e.data.forEach((t,a)=>{t._style||(t._style={},t._style.left=_(),t._style.top=B(),M(a))}),o.value=z(l.value)};F(()=>{e.data.forEach(t=>{delete t._style})});const _=()=>I(l.value)*(r.value+e.columnSpacing)+p.value,B=()=>S(l.value),M=t=>{const a=I(l.value);l.value[a]+=i[t]+e.rowSpacing};C(()=>e.data,t=>{W(()=>{t.every(s=>!s._style)&&f(),e.picturePreReading?x():T()})},{deep:!0,immediate:!0});const N=()=>{setTimeout(()=>{y(),e.data.forEach(t=>{t._style=null})},200)};return C(()=>e.column,()=>{e.picturePreReading&&(r.value=0),N()}),(t,a)=>(d(),h("div",{ref_key:"containerTarget",ref:m,class:"relative",style:w({height:o.value+"px"})},[r.value&&n.data.length?(d(!0),h(L,{key:0},P(n.data,(s,g)=>{var E,H;return d(),h("div",{key:n.nodeKey?s[n.nodeKey]:g,class:"m-waterfall-item absolute duration-300",style:w({width:r.value+"px",left:((E=s._style)==null?void 0:E.left)+"px",top:((H=s._style)==null?void 0:H.top)+"px"})},[O(t.$slots,"default",{item:s,width:r.value,index:g})],4)}),128)):(d(),h("div",G,"\u52A0\u8F7D\u4E2D..."))],4))}};export{$ as default};
